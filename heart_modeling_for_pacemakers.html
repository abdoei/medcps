<!DOCTYPE html>
<html lang="en">
<script src="components/header.js" type="text/javascript" defer></script>
<script src="components/navigation.js" type="text/javascript" defer></script>
<script src="components/footer.js" type="text/javascript" defer></script>

<header-component></header-component>

<body>
<navigation-component></navigation-component>

<div class="breadcrumbs margin-bottom-40">
    <div class="container">
        <h1 class="pull-left">Heart Modeling for Closed-loop Pacemaker Verification & Validation</h1>
    </div>
</div>

<!--=== Content Part ===-->
<div class="container">		
	<div class="row">            
        <div class="col-md-9">
            <div class="headline"><h2>Problem Statement</h2></div>
            <div class="panel-group acc-v1 margin-bottom-40" id="accordion">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title">
                            <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion" href="#collapseOne">
                                <strong>Motivation</strong></a>
                        </h3>
                    </div>
                    <div id="collapseOne" class="panel-collapse collapse in">
                        <div class="panel-body">
                            <img src="assets/img/main/pacemaker.png" alt="" width="100" class="pull-right lft-img-margin img-width-100">
                            <ul class="list-unstyled">
                              <li>
                                <h4><i class="icon-thumbs-down color-red"></i>Over <strong class="color-red">600,000</strong> cardiac medical devices recalled from 1990-2000.</h4>
                              </li>
                              <li><h4><i class="icon-thumbs-down color-red"></i><strong class="color-red">40%</strong> of recent recalls were due to <strong class="color-red">software issues </strong></h4></li>
                              <!--<li><h4><i class="icon-hand-right color-green"></i>It is essential to guarantee the <strong>safety</strong> and <strong>efficacy</strong> of the device software</h4></li>-->
                             
                          </ul>
                         <blockquote>
                        <h3>It is essential to guarantee the <strong class="color-green">safety</strong> and <strong class="color-green">efficacy</strong> of the device software</h3>
                        
                    </blockquote>   
                      </div>
                    </div>
                </div>
                 <div class="panel panel-default">
                    <div class="panel-heading">
                        <h4 class="panel-title">
                            <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion" href="#collapseFour">
                                <strong>Cyber Physical Challenges for Medical Devices Evaluation</strong>
                            </a>
                        </h4>
                    </div>
                    <div id="collapseFour" class="panel-collapse collapse in">
                        <div class="panel-body">
                        <img src="assets/img/challenges.png" alt="" width="300" class="pull-right lft-img-margin img-width-300">
                            <ul class="list-unstyled">
                              <li>
                                <i class="icon-hand-right color-red"></i> <strong>The Pacemaker (and other medical devices):</strong>
                                <ul>
                                <li> Autonomous device with minimum human interaction, therefore has to be able to operate under all possible conditions.
</li>
<li>Limited diagnostic capability, inevitably leading to false-positives and false-negatives, and limited therapy capability, being able to treat the disease to a certain degree.  
</li>
<li>It is the safety of the patient we care about. Therefore the safety of the pacemaker must be evaluated in closed-loop within its environment
</li>
                               </ul>
                              <li>
                                <i class="icon-hand-right color-red"></i> <strong>The physical plant:</strong>
                                <ul>
                                <li> Not only the heart, but also the rest of the body

</li>
<li>Different dynamics even in a single patient

</li>
<li>Each condition has its own corresponding optimal condition 

</li>
                               </ul>
                              </li>
                          </ul>
                        </div>
                    </div>
                </div>
<div class="panel panel-default">
                    <div class="panel-heading">
                        <h4 class="panel-title">
                            <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion" href="#collapse2">
                                <strong>FDA Pre-market Certification and the State-of-the-art Evaluations</strong>
                            </a>
                        </h4>
                    </div>
                    <div id="collapse2" class="panel-collapse collapse in">
                        <div class="panel-body">
                        <img src="assets/img/main/fda-logo.jpg" alt="" width="150" class="pull-right lft-img-margin img-width-150">
                           Currently the US FDA requires the device manufacturers to submit proofs for:
                            <ul class="list-unstyled">
                              <li>
                                <p><i class="icon-hand-right color-red"></i><strong>The final product:</strong> The safety and efficacy of the device itself</p>
                              </li>
                              <li>
                                <p><i class="icon-hand-right color-red"></i><strong>The development process: </strong>Rigorous design process which provides <strong class="color-red">traceability</strong> of requirements</p>
                              </li>
                              
                          </ul> 
                          Currently the device manufacturers use <strong class="color-red">open-loop testing</strong> to evaluate the safety of the device and there is <strong class="color-red">no formal methodologies</strong> during the design process. 
                        </div>
                    </div>
              </div>
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h4 class="panel-title">
                            <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion" href="#collapseTwo">
                                <strong>The problem of open-loop testing</strong>
                            </a>
                        </h4>
                        
                    </div>
                    <div id="collapseTwo" class="panel-collapse collapse in">
                        <div class="panel-body">
                            <img src="assets/img/main/open-loop.png" alt="" width="300" class="pull-right lft-img-margin img-width-100">
                                                       
                            <p>During the past decades, pacemakers implanted into patients have recorded episodes of closed-loop interactions (Senario 1 ~ Senario N) between the heart in different conditions (Heart 1 ~ Heart N) and the pacemaker . The recordings are either appropriate pacemaker behavior in response to heart condition which all new pacemakers should also have, or inappropriate pacemaker behavior so that the new pacemakers should avoid. In order to evaluate the performance of a new pacemaker design (Pacemaker X), the inputs from the hearts in those recordings, representing different heart conditions, are fed into the new pacemaker and the outputs of the new pacemaker are compared to the recorded outputs in those senarios. </p>
                            
                            <p><strong class="color-red">The problem of open-loop testing</strong> is that the input signals from heart do not capture the heart physiology and will not change to different pacemaker outputs. Given a closed-loop interaction between Heart i and Pacemaker i and feed its heart input signals to Pacemaker X will not capture the closed-loop behavior of Pacemaker X under heart condition i. In order to evaluate pacemaker executions under different heart conditions, especially the executions with adquate depth, there has to be a model of the heart which can capture the physiological conditions of the heart and respond to pacemaker outputs.</p>
                            
                      </div>
                    </div>
                </div>

                
                 <div class="panel panel-default">
                    <div class="panel-heading">
                        <h4 class="panel-title">
                            <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion" href="#collapseThree">
                                <strong>Closing the loop with a model of the heart</strong>
                            </a>
                        </h4>
                    </div>
                    <div id="collapseThree" class="panel-collapse collapse in">
                        <div class="panel-body">
                        <img src="assets/img/main/MBD_heart.png" alt="" width="400" class="pull-right lft-img-margin img-width-400">
                            <p>We developed a model-based design framework for pacemaker software. A heart model structure was designed based on the electrophysiology of the heart. At each development stage a version of the heart model is available to interact with the pacemaker model/implementation.</p>
                                              <ul class="list-unstyled">
                                <li><i class="icon-ok color-green"></i> At verification level we have a set of <strong class="color-green">non-deterministic</strong> version of our heart models with different abstraction level which covers all possible inputs to the pacemaker under different heart conditions. Depending on the condition of the safety/efficacy properties, we choose heart model with appropirate structure and abstraction level to cover the inputs to the pacemaker under heart conditions specified in the properties. </li>
                                <li><i class="icon-ok color-green"></i>
                                At Simulation level the non-determinism of our heart model are resolved by linear interpolation of the parameter ranges. The <strong class="color-green">deterministic</strong> version of our heart model responds to pacemaker pacing signals the same way as a real heart. 
                                </li>
                                <li><i class="icon-ok color-green"></i>
                                The deterministic heart model can be translated into HDL code by Mathworks HDL coder and implemented on a FPGA chip. With appropriate analog interface, the platform can be used for closed-loop testing of pacemaker implementations.
                                </li>
                                </ul>      
                      </div>
                    </div>
                </div>
                 <div class="headline"><h2>Heart Basics</h2></div>
                 <img src="assets/img/basic.png" alt="" width="400" class="pull-right lft-img-margin img-width-400">
                 <p>The coordinated contraction of the heart muscles are governed by the electrical conduction system. The Sinoatrial (SA) node, which is the natual pacemaker, periodically generates electrical impulses that conduct along the electrical conduction system, triggering muscle contractions. Anormalies in the <strong class="color-green">generation</strong> and/or <strong class="color-green">conduction</strong> of the electrical signals will result in irregular heart rhythms, which are referred to as <strong class="color-green">arrthymia</strong>.</p>
                 <p>When a heart tissue encounters a voltage change, it discharges the ions inside, causing voltage change outside the tissue. The behavior is referred to as <strong class="color-green">depolarization</strong>. The figure on the left illustrates the voltage changes over time (Action Potential) outside a heart tissue (solid line) and its nearby tissue (dashed line). After the outside voltage reaches a certain threshold after some time, the tissue nearby is also depolarized. This domino effect continues so the initial depolarization from the SA node can travel through the whole heart. After the depolarization the tissue needs time to recharge, as we can see the voltage gradually drop back to its resting value. This recharging period is referred to as the <strong class="color-green">Refractory</strong> period during which new depolarization will be inhibited or triggering deformed action potential. The colored bar below shows the corresponding timing periods. More information can be found in this quick tutorial. </p>
                <div class="headline"><h2>Heart Modeling</h2></div>
               
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h4 class="panel-title">
                            <a class="accordion-toggle" data-toggle="collapse" data-parent="#test" href="#collapse4">
                                <strong>Timed automata vs. other formalisms</strong>
                            </a>
                        </h4>
                    </div>
                    
                    <div id="collapse4" class="panel-collapse collapse in">
                        <div class="panel-body">
                        
                            <p> We chose Timed Automata as the formalism for the heart model for several reasons:</p>
                             <ul class="list-unstyled">
                             <li>
                                <p><i class="icon-hand-right color-green"></i>Nondeterminism which enables model abstraction which increase coverage.
                                </p>
                               </li>
                                <li><i class="icon-hand-right color-green"></i>The reachability problem for timed automata is decidable, allowing us to explore the whole state space of the heart and pacemaker. 
                                </li>
                                <li><i class="icon-hand-right color-green"></i>Most timing behaviors of the heart can be captured by timed automata
                                </li>
                          </ul>
                     
                                              
                      </div>
                    </div>
                </div>
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h4 class="panel-title">
                            <a class="accordion-toggle" data-toggle="collapse" data-parent="#test" href="#collapse3">
                                <strong>The proper level of abstraction: Coverage vs. Expressiveness</strong>
                            </a>
                        </h4>
                    </div>
                    
                    <div id="collapse3" class="panel-collapse in">
                        <div class="panel-body">
                        <img src="assets/img/main/coverage.png" alt="" width="300" class="pull-right lft-img-margin img-width-300">
                            <p>In order to be used in different stages during the development process, the <strong class="color-green">structure</strong> and <strong class="color-green">parameters</strong> of our heart model need to be adjusted to balance between <strong class="color-green">Coverage vs. Expressiveness</strong>.</p> 
                            <p>Intuitively, the more complex the model is, there is more constraints on its behaviors, thus limiting its coverage. On the other hand, the added complexity allows us to capture more detailed mechanisms of the heart, allowing us to precisely model a specific heart condition. So instead of developing a single heart model, we developed a series of heart models at different abstraction levels. With <strong class="color-green"><a href="verification.html#CEGAR" target="_self">Counter-Example-Guided Abstraction & Refinement (CEGAR)</a></strong> framework, we are able to choose the proper level of heart model abstraction during verification thus balancing coverage and expressiveness.</p>
                                              
                      </div>
                    </div>
                </div>
                <div class="headline"><h3><a id="abstraction"></a>Heart Abstractions</h3></div>
                <p>For evaluating pacemaker which has only two leads and do simple thresholding for signal processing, we developed heart models at different abstraction levels, where each abstraction covers all possible states of the model in the previous abstraction level. Each abstraction step reduces <strong class="color-green">the complexity of the timed automata component</strong> and/or <strong class="color-green">the structure of the whole model</strong>. This establishes a <strong class="color-green">timed simulation</strong> relationship between abstraction levels with <img src="assets/img/equations/simulation.png"> where n=[1,4]. More details on heart model abstraction can be found in our <strong class="color-green1"><a href="http://repository.upenn.edu/mlab_papers/58/" target="_blank">STTT paper</a></strong>. </p>
              <p>&nbsp;</p>
                <div class="tab-v1">
                <!-- <ul class="nav nav-tabs">
                    <li class="active"><a href="#ab0" data-toggle="tab">Abstraction 0</a></li>
                    <li><a href="#ab1" data-toggle="tab">Abstraction 1</a></li>
                    <li><a href="#ab2" data-toggle="tab">Abstraction 2</a></li>
                    <li><a href="#ab3" data-toggle="tab">Abstraction 3</a></li>
                    <li><a href="#ab4" data-toggle="tab">Abstraction 4</a></li>
                </ul>                 -->
                <div class="tab-content">
                    <div class="tab-pane active" id="ab0">
                        <div class="row">
                           
                            <div class="col-md-12">
                                <h4>Behaviorial Model of Heart Tissue</h4>
                              <img src="assets/img/N0.png" alt="" width="435" class="pull-right lft-img-margin img-width-430">
                            <p>We first start with modeling the electrical behaviors of a heart tissue. A whole model of the heart consists of node automata (N0) which models the timed transitions among different time periods with different behaviors after the tissue is depolarized. The heart can then be modeled as: <img src="assets/img/equations/H0.png"> where N can be arbitarily large.</p><p><strong class="color-green">Proposed use:</strong><p> 
                            <ul class="list-unstyled">
                             <li>
                                <i class="icon-hand-right color-green"></i>Study complex and chaotic heart conditions like Atrial Fibrillation.</li>
                                <li>
                                <i class="icon-hand-right color-green"></i>Creating spatial and temporal map of the heart during Electrophysiology Studies
                                </li>
                              </ul>
                                
                                </p>       
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane active" id="ab1">
                             <img src="assets/img/N1.png" alt="" width="400" class="pull-right lft-img-margin img-width-400">          
                      <h4>Abstract conduction delay with paths</h4>
                         <p>In this abstraction we replace the <em>cond</em> state of N0 with path automata. The heart model H0 can be replaced by <img src="assets/img/equations/H0.5.png">. A more general abstraction abstracts 3 nodes and 2 paths into 2 nodes and 1 path:<img src="assets/img/equations/3to2.png">. With this property we can further abstract the structure of the model. The heart model H0.5 can be further abstracted into <img src="assets/img/equations/H1.png"> where m=9 in the structure shown on the right.<p><strong class="color-green">Proposed use:</strong><p> 
                            <ul class="list-unstyled"> 
                            <li>
                                <i class="icon-hand-right color-green"></i>Study heart conditions with additional pathways including reentry circuits.
                              </li>
                             <li>
                                <i class="icon-hand-right color-green"></i>Patient-specific heart model for general Electrophysiology Study.</li>
                               
                      </ul>
                                
                                </p>     </p>
                    </div>
                    <div class="tab-pane active" id="ab2">
                        <h4>Merging equivalent states</h4>
                        <p><img src="assets/img/N2.png" alt="" width="400" class="pull-right lft-img-margin img-width-400">At this abstraction level, we merge the <em>RRP</em> state with the <em>Rest</em> state in the node automata and <em>Double</em> with the <em>Idle</em> state in the path automata due to the same behavior. We also further abstract the structure of the heart model so H1 can be abstracted with <img src="assets/img/equations/H2.png">. The AV node has very large ERP period thus cannot be abstracted away.<p><strong class="color-green">Proposed use:</strong><p> 
                            
                                <i class="icon-hand-right color-green"></i>Verify pacemaker algorithms in which the blocking property of the AV node cannot be ignored
                                
                                </p>     </p>
                    </div>
                    <div class="tab-pane active" id="ab3">
                        <h4>Replacing the blocking property of ERP with non-determinism</h4>
                        <p><img src="assets/img/N3.png" alt="" width="400" class="pull-right lft-img-margin img-width-400"> The node automata do not trigger path conduction in response to external activation during its ERP state. In this abstraction level, this function is replaced by a non-determnistic transition in the path automata, as shown in the figure on the right. As a result of the abstraction, the AV node can be abstracted away and the heart model H2 can be abstracted by <img src="assets/img/equations/H3.png">.<p><strong class="color-green">Proposed use:</strong><p> 
                            
                                <i class="icon-hand-right color-green"></i>Verify pacemaker algorithms in which A-V conduction cannot be ignored
                                
                                </p>     </p></p>
                    </div>
                    <div class="tab-pane active" id="ab4">
                        <h4>Abstracting the conduction property with non-determinism</h4>
                        <p><img src="assets/img/N4.png" alt="" width="400" class="pull-right lft-img-margin img-width-400"> Since the pacemaker only has two leads, the structure of the heart model can be further reduced to two node automata which can generate inputs to the pacemaker without timing constraints. The heart model H3 can be further abstracted to <img src="assets/img/equations/H4.png">. This heart model covers all possible inputs to the pacemaker and is our most abstracted model. </p><p><strong class="color-green">Proposed use:</strong><p> 
                            
                                <i class="icon-hand-right color-green"></i>Verify pacemaker algorithms with unconditional properties.
                                
                                </p>     </p></p>
                    </div>
                </div>
            </div>
            

                                                      
                
                       
        </div>
        
               
<div class="headline"><h3>Heart Model Simulation & Implementation</h3></div>
<div class="panel-group acc-v1 margin-bottom-40" id="accordion">
<div class="panel panel-default">
                    <div class="panel-heading">
                        <h4 class="panel-title">
                            <a class="accordion-toggle" data-toggle="collapse" data-parent="#test" href="#collapse8">
                                <strong>Deterministic Heart Model</strong>
                            </a>
                        </h4>
                    </div>
                    
                    <div id="collapse8" class="panel-collapse collapse in">
                        <div class="panel-body">
                        <p><img src="assets/img/WB.png" alt="" width="400" class="pull-right lft-img-margin img-width-400">
                             For simulation the heart model has to be deterministic. We resolve the non-determinism in our heart models with linear interpolation. The ERP period of the node automata and the conduction delay of the path automata are determined by the state of the node automata when it was activated. In this way we are able to simulate progressive heart behaviors like the <strong class="color-green">Wenckebach A-V block</strong> which is shown on the right. More details on the linear interpolation can be found in our <strong class="color-green"><a href="http://repository.upenn.edu/mlab_papers/21/" target="_blank">VHM proceeding paper</a></strong>. </p>
                             
                     
                                              
                      </div>
                    </div>
                </div>
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h4 class="panel-title">
                            <a class="accordion-toggle" data-toggle="collapse" data-parent="#test" href="#collapse5">
                                <strong>Interfacing with pacemaker</strong>
                            </a>
                        </h4>
                    </div>
                    
                    <div id="collapse5" class="panel-collapse collapse in">
                        <div class="panel-body">
                        <p><img src="assets/img/egm.gif" alt="" width="300" class="pull-right lft-img-margin img-width-300">
                          Pacemaker has two leads placed against the inner heart wall. Each lead has two electodes which can sense the electrical voltage changes near the heart tissue. The depolarizations of the heart tissue travel across the heart like a<strong class="color-green"> wave</strong>. Clinical studies shows that the depolarization wave move toward and away from the electrode, the voltage sensed by the electrode increases and decreases correspondingly.</p> 
                             <p>We model this behavior by calculating the distance between the location of the depolarization wave within the path automata, and the location of the electrode. The animation on the right shows the simulated voltage sensed by two electrodes (Uni1,Uni2). The left column shows the analog signal sensed by the two electrodes and their difference. The right column shows the logical pulses that the pacemaker gets after simple thersholding. </p>
                             <p>With the model of the electrodes we are able to put imaginary electrodes at different places of our heart model. This also allows us to simulate behaviors like <strong class="color-green">pacemaker lead dislodge and crosstalk</strong>. More information on these subjects can be found in our <a href="http://repository.upenn.edu/mlab_papers/22/" target="_blank"><strong class="color-green1">EMBC'11 paper</strong></a></p>
                     
                                              
                      </div>
                    </div>
                </div>
                
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h4 class="panel-title">
                            <a class="accordion-toggle" data-toggle="collapse" data-parent="#test" href="#collapse7">
                                <strong>Matlab User Interface</strong>
                            </a>
                        </h4>
                    </div>
                    
                    <div id="collapse7" class="panel-collapse collapse in">
                        <div class="panel-body">
                        <p><img src="assets/img/emg.gif" alt="" width="400" class="pull-right lft-img-margin img-width-400">
                            <p> We created an user interface in Matlab so the user can create a heart model, interact with it and visualize the simulation.</p>
                             
                     
                                              
                      </div>
                    </div>
                </div>
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h4 class="panel-title">
                            <a class="accordion-toggle" data-toggle="collapse" data-parent="#test" href="#collapse6">
                                <strong>Heart On a Chip</strong>
                            </a>
                        </h4>
                    </div>
                    
                    <div id="collapse6" class="panel-collapse in">
                        <div class="panel-body">
                        <p><img src="assets/img/HOC.png" alt="" width="400" class="pull-right lft-img-margin img-width-400">
                            <p>The heart models created in the user interface can be automatically generated into executable files and run on a hardware platform. The first version of the Heart On a Chip platform uses a FPGA board to run the heart model. Through an analog interface circuit the heart model can interact with a real pacemaker. This platform enables us to do closed-loop testing on a pacemaker implementation with different heart conditions. More details on the platform can be found on <a href="http://pvs.medcps.org" target="_blank"><strong>this website</strong></a> and our <a href="http://repository.upenn.edu/mlab_papers/55" target="_blank"><strong>technical report</strong></a>.</p>
                            <p>The second generation Heart On a Chip will be on a microcontroller with easier configuration and richer interface. The platform will be provided to the research community with low cost. Information on how to get access to the platform is coming soon.</p> 
                             
                     
                                              
                      </div>
                    </div>
                </div>
                    </div>
		</div><!--/col-md-9-->
        
		<div class="col-md-3">
        </div><!--/col-md-3-->            		
    </div><!--/row-->
</div>

<footer-component></footer-component>

<script type="text/javascript" src="assets/css/jquery-1.10.2.min.js"></script>
<script type="text/javascript" src="assets/css/hover-dropdown.min.js"></script>

</body>
</html>	